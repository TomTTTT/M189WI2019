---
title: "Unusual Cluster in the Palindrome"
author: "Benson Wu"
date: "February 19, 2019"
output: pdf_document
---

#Abstract

#Method
#Result
#Conclusion

\pagebreak


```{r, include=F, message=F}
path<-"C:/Users/buwen/"
setwd(paste0(path,'Documents/Git/M189WI2019/HW3'))

#Load dependencies
library(dplyr)
library(ggplot2)
library(reshape2)
library(gridExtra)
library(stargazer)
library(tree)
library(rattle)
library(rpart)
library(rpart.plot)
library(party)
library(ggsci)
library(Hmisc)
library(lattice)
library(knitr)
library(purrr)
library(OneR)
library(nnet)

#Load Data
df<-read.csv("Data1.txt")
```
#Background
DNA has a double helix structure made of two long chains of nucleotides. Each nucleotide is composed of a sugar, a phosphate and a base. The bases have four types: adenine (A), cytosine (C) , guanine (G), and thymine (T). In this analysis, we look particularly at the DNA sequence of Human cytomegalovirus (CMV). CMV is a common virus that infects people of all ages. When CMV is in a person's body, it stays there for life, but most people infected with CMV show no signs or symptoms. However, CMV infection can cause grave health problems for people with weakened immune systems and for unborn babies. Our data set is a sequence of CMV DNA that is 229,354 letters long, and 296 palindromes of length greater than 10 were found in this particular DNA sequence of CMV. It is hypothesized that being able to find origins of replication through palindrome locations will enable better understanding of how CMV can be eliminated. The following figures show the distribution of palindromes across the DNA sequence with respect to different bin sizes. We can see that the clusters of palindromes change as we increase the bin sizes.  
  
  

```{r, echo=F}
########PART 1#########

#Some histograms with various bin widths for our data
binlist<-c(3000,4500,6000,10000)
for(i in binlist){
  eval(parse(text=paste0("
  cmv_p_",i,"<-ggplot(df, aes(x=location)) +
  geom_histogram(color='black', fill='red', binwidth = ",i,", position = 'dodge', alpha=0.5) +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5), 
        axis.text.x = element_text(angle = 60, hjust = 1),
        axis.title.x=element_blank(), axis.title.y=element_blank()) +
  labs(x = 'DNA Base Pair Index', subtitle='Bin Width = ",i," base pairs') +
  scale_x_continuous(breaks = seq(0, 229354, 25000))
                         "))) 
}
grid.arrange(cmv_p_3000,cmv_p_4500,cmv_p_6000,cmv_p_10000, bottom=textGrob("DNA Base Pair Index", gp=gpar(fontsize=15)),
             left = textGrob("Count", rot = 90, vjust = 0.4, gp=gpar(fontsize=15)), 
             top=textGrob("CMV Palindrome Locations with Different Bin Withs ",gp=gpar(fontsize=20)))

```
\pagebreak

#Random Scatter

We first begin by performing a random scatter through Monte Carlo uniform to scatter 296 palindromes across a DNA sequence of 229,354 base pairs. Three simulations were done in order to ensure randomness. The simulations are compared visually compared to the location of palindromes in our original data in the following figures. The following plot shows the 2D scatter of palindromes across the original DNA sequence and the simulated palindrome locations.

```{r, echo=F}
strip_df<-stripplot(df$location, jitter=0.1, offset=1/3,xlab="", main="Original Data")
####Generation process###vv
N<-229354 #Length of CMV
n<-296 #Number of palindromes

##Random Scatter
#Loop that does random scatter and generates plot
for(j in 1:3){

  #Set seed
  set.seed(j)

  #Create empty vector
  eval(parse(text=paste0("unifMC_",j,"<-rep(0,296)")))
  
  #Uniform MC generation
  for(i in 1:296){
    eval(parse(text=paste0("unifMC_",j,"[i]<-rdunif(1, N, 1)")))
  }

#Sort values and put it into dataframe
eval(parse(text=paste0("unifMC_",j,"<-sort(unifMC_",j,", decreasing=FALSE)")))
eval(parse(text=paste0("unifMC_",j,"<-as.data.frame(unifMC_",j,")")))

#Rename the location column 
eval(parse(text=paste0("colnames(unifMC_",j,")[1] <- 'location'")))

#Create plots of simulated palindrome locations
eval(parse(text=paste0("
unifMC_p",j,"<-ggplot(unifMC_",j,", aes(x=location)) +
  geom_histogram(color='black', fill='blue', binwidth = 4500, position = 'dodge', alpha=0.5) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5), 
        axis.text.x = element_text(angle = 60, hjust = 1), axis.title.y=element_blank(), axis.title.x=element_blank()) +
  labs(title = 'CMV Palindrome Location',
       subtitle='Uniform Scatter: Iteration ",j,"') +
  scale_x_continuous(breaks = seq(0, 229354, 25000)) 

")))
eval(parse(text=paste0("strip_",j,"<-stripplot(df$location, jitter=0.1, offset=1/3, xlab='', main = 'Iteration ",j,"')")))
}

grid.arrange(strip_df, strip_1, strip_2, strip_3)
```


As we can observe, it is hard to tell if there are significant clusters because the simulated palindrome locations seem to have multiple clusters that are spread evenly across the DNA sequence, indicating that the original data departs from a uniform scatter of palindromes across the DNA sequence.

\pagebreak

The following figure shows the distribution of palindromes across the DNA sequence with the bin size set to 4500. Again, we see that there is no significant cluster of palindromes in the simulated data. This leads us to investigate the location and spacings of palindromes next.

```{r, echo=F}
#Let's generate a few Monte Carlo Samples
####Generation process###vv
N<-229354 #Length of CMV
n<-296 #Number of palindromes

##Random Scatter
#Loop that does random scatter and generates plot
for(j in 1:3){

  #Set seed
  set.seed(j)

  #Create empty vector
  eval(parse(text=paste0("unifMC_",j,"<-rep(0,296)")))
  
  #Uniform MC generation
  for(i in 1:296){
    eval(parse(text=paste0("unifMC_",j,"[i]<-rdunif(1, N, 1)")))
  }

#Sort values and put it into dataframe
eval(parse(text=paste0("unifMC_",j,"<-sort(unifMC_",j,", decreasing=FALSE)")))
eval(parse(text=paste0("unifMC_",j,"<-as.data.frame(unifMC_",j,")")))

#Rename the location column 
eval(parse(text=paste0("colnames(unifMC_",j,")[1] <- 'location'")))

#Create plots of simulated palindrome locations
eval(parse(text=paste0("
unifMC_p",j,"<-ggplot(unifMC_",j,", aes(x=location)) +
  geom_histogram(color='black', fill='blue', binwidth = 4500, position = 'dodge', alpha=0.5) + 
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5), 
        axis.text.x = element_text(angle = 60, hjust = 1), axis.title.y=element_blank(), axis.title.x=element_blank()) +
  labs(title = 'CMV Palindrome Location',
       subtitle='Uniform Scatter: Iteration ",j,"') +
  scale_x_continuous(breaks = seq(0, 229354, 25000)) 
")))
}


#Use histograms from original data, but remove x/y axis titles from the plots
binlist<-c(3000,4500,6000,10000)
for(i in binlist){
  eval(parse(text=paste0("
                         cmv_p_",i,"<-ggplot(df, aes(x=location)) +
                         geom_histogram(color='black', fill='red', binwidth = ",i,", position = 'dodge', alpha=0.5) +
                         theme(plot.title = element_text(hjust = 0.5),
                         plot.subtitle = element_text(hjust = 0.5), 
                         axis.text.x = element_text(angle = 60, hjust = 1),
                         axis.title.x=element_blank(), axis.title.y=element_blank()) +
                         labs(x = 'DNA Base Pair Index', title = 'CMV Palindrome Location',
                         subtitle='Bin Width = ",i,"') +
                         scale_x_continuous(breaks = seq(0, 229354, 25000))
                         "))) 
}

#Use this graph in markdown 
grid.arrange(cmv_p_4500,unifMC_p1,unifMC_p2,unifMC_p3, bottom=textGrob("DNA Base Pair Index", gp=gpar(fontsize=15)),
             left = textGrob("Count", rot = 90, vjust = 0.4, gp=gpar(fontsize=15)), ncol=2, nrow=2)

```


#Location and  Spacings



```{r, echo=F,message=FALSE, warning=FALSE}
####Part 2 Locations and spacings 

#Create column that gives distance between pairs, triplets, quintuples of Palindromes

#List of dataframes to loop through
dataframelist<-c("df", "unifMC_1","unifMC_2","unifMC_3")

for(i in dataframelist){
  eval(parse(text=paste0("
  #Pair
  ",i,"$location_lag <- Lag(",i,"$location, 1)
  ",i,"$distance_pair<- ",i,"$location-",i,"$location_lag
  ",i,"$location_lag<-NULL
  ",i,"_pair<-ggplot(",i,", aes(x=distance_pair)) +
                    geom_histogram(color='black', fill='red',position='dodge',alpha=0.5,bins=30) +
                    theme(axis.title.x=element_blank(),axis.title.y=element_blank()) 
  #Triplet
  ",i,"$location_lag <- Lag(",i,"$location, 2)
  ",i,"$distance_triplet <- ",i,"$location-",i,"$location_lag
  ",i,"$location_lag<-NULL
  ",i,"_triplet<-ggplot(",i,", aes(x=distance_triplet)) + 
                        geom_histogram(color='black', fill='blue',position='dodge',alpha=0.5,bins=30) + 
                        theme(axis.title.x=element_blank(),axis.title.y=element_blank())
  #Quintuples
  ",i,"$location_lag <- Lag(",i,"$location, 5)
  ",i,"$distance_quint <- ",i,"$location-",i,"$location_lag
  ",i,"$location_lag<-NULL
  ",i,"_quint<-ggplot(",i,", aes(x=distance_quint)) + 
                      geom_histogram(color='black', fill='green',position='dodge',alpha=0.5,bins=30) +
                      theme(axis.title.x=element_blank(),axis.title.y=element_blank())
  ")))
}


#Arrange all plots into 4x3 matrix
grid.arrange(arrangeGrob(df_pair, unifMC_1_pair, unifMC_2_pair, unifMC_3_pair,nrow=4, top="Pair"),
arrangeGrob(df_triplet, unifMC_2_triplet, unifMC_2_triplet, unifMC_3_triplet,nrow=4, top="Triplet"),
arrangeGrob(df_quint, unifMC_1_quint, unifMC_2_quint, unifMC_3_quint,nrow=4, top="Quintuple"), 
bottom=textGrob("Letter Index", gp=gpar(fontsize=15)),
left = textGrob("Count", rot = 90, vjust = 0.2, gp=gpar(fontsize=15)), ncol=3,as.table = FALSE)

```



#Theory
##Maximum Likelihood Estimation
##Poisson Process
##Chi-Square Test


#Poisson
$P\left( x \right) = \frac{{e^{ - \lambda } \lambda ^x }}{{x!}}$

$\displaystyle {\mathcal{L}}({\lambda}\:;x_1\:,..,x_n) = \prod_{i=1}^{\infty}\frac{{e^{ - \lambda } \lambda ^{x_j} }}{{x_j!}}$

$\hat{\lambda}$